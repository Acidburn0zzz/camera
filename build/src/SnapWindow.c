/* SnapWindow.c generated by valac 0.14.0, the Vala compiler
 * generated from SnapWindow.vala, do not modify */

/* -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-*/

#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <granite.h>
#include <gst/gst.h>
#include <stdlib.h>
#include <string.h>
#include <gst/interfaces/xoverlay.h>
#include <gdk/gdkx.h>


#define SNAP_TYPE_SNAP_WINDOW (snap_snap_window_get_type ())
#define SNAP_SNAP_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SNAP_TYPE_SNAP_WINDOW, SnapSnapWindow))
#define SNAP_SNAP_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SNAP_TYPE_SNAP_WINDOW, SnapSnapWindowClass))
#define SNAP_IS_SNAP_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SNAP_TYPE_SNAP_WINDOW))
#define SNAP_IS_SNAP_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SNAP_TYPE_SNAP_WINDOW))
#define SNAP_SNAP_WINDOW_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SNAP_TYPE_SNAP_WINDOW, SnapSnapWindowClass))

typedef struct _SnapSnapWindow SnapSnapWindow;
typedef struct _SnapSnapWindowClass SnapSnapWindowClass;
typedef struct _SnapSnapWindowPrivate SnapSnapWindowPrivate;

#define SNAP_TYPE_SNAP_APP (snap_snap_app_get_type ())
#define SNAP_SNAP_APP(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SNAP_TYPE_SNAP_APP, SnapSnapApp))
#define SNAP_SNAP_APP_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SNAP_TYPE_SNAP_APP, SnapSnapAppClass))
#define SNAP_IS_SNAP_APP(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SNAP_TYPE_SNAP_APP))
#define SNAP_IS_SNAP_APP_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SNAP_TYPE_SNAP_APP))
#define SNAP_SNAP_APP_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SNAP_TYPE_SNAP_APP, SnapSnapAppClass))

typedef struct _SnapSnapApp SnapSnapApp;
typedef struct _SnapSnapAppClass SnapSnapAppClass;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _gst_object_unref0(var) ((var == NULL) ? NULL : (var = (gst_object_unref (var), NULL)))

struct _SnapSnapWindow {
	GtkWindow parent_instance;
	SnapSnapWindowPrivate * priv;
	SnapSnapApp* snap_app;
};

struct _SnapSnapWindowClass {
	GtkWindowClass parent_class;
};

struct _SnapSnapWindowPrivate {
	GtkDrawingArea* drawing_area;
	GstPipeline* pipeline;
	GstElement* src;
	GstElement* sink;
};


static gpointer snap_snap_window_parent_class = NULL;

GType snap_snap_window_get_type (void) G_GNUC_CONST;
GType snap_snap_app_get_type (void) G_GNUC_CONST;
#define SNAP_SNAP_WINDOW_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), SNAP_TYPE_SNAP_WINDOW, SnapSnapWindowPrivate))
enum  {
	SNAP_SNAP_WINDOW_DUMMY_PROPERTY
};
#define SNAP_SNAP_WINDOW_TITLE "Snap"
SnapSnapWindow* snap_snap_window_new (SnapSnapApp* snap_app);
SnapSnapWindow* snap_snap_window_construct (GType object_type, SnapSnapApp* snap_app);
static void snap_snap_window_setup_window (SnapSnapWindow* self);
static void snap_snap_window_setup_gst_pipeline (SnapSnapWindow* self);
static void snap_snap_window_on_play (SnapSnapWindow* self);
static void _snap_snap_window_on_play_gtk_button_clicked (GtkButton* _sender, gpointer self);
static void snap_snap_window_on_stop (SnapSnapWindow* self);
static void _snap_snap_window_on_stop_gtk_button_clicked (GtkButton* _sender, gpointer self);
static void _gtk_main_quit_gtk_button_clicked (GtkButton* _sender, gpointer self);
static void snap_snap_window_finalize (GObject* obj);


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


SnapSnapWindow* snap_snap_window_construct (GType object_type, SnapSnapApp* snap_app) {
	SnapSnapWindow * self = NULL;
	SnapSnapApp* _tmp0_;
	SnapSnapApp* _tmp1_;
	SnapSnapApp* _tmp2_;
	g_return_val_if_fail (snap_app != NULL, NULL);
	self = (SnapSnapWindow*) g_object_new (object_type, NULL);
	_tmp0_ = snap_app;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	_g_object_unref0 (self->snap_app);
	self->snap_app = _tmp1_;
	_tmp2_ = self->snap_app;
	gtk_window_set_application ((GtkWindow*) self, (GtkApplication*) _tmp2_);
	gtk_window_set_title ((GtkWindow*) self, SNAP_SNAP_WINDOW_TITLE);
	snap_snap_window_setup_window (self);
	snap_snap_window_setup_gst_pipeline (self);
	return self;
}


SnapSnapWindow* snap_snap_window_new (SnapSnapApp* snap_app) {
	return snap_snap_window_construct (SNAP_TYPE_SNAP_WINDOW, snap_app);
}


static void _snap_snap_window_on_play_gtk_button_clicked (GtkButton* _sender, gpointer self) {
	snap_snap_window_on_play (self);
}


static void _snap_snap_window_on_stop_gtk_button_clicked (GtkButton* _sender, gpointer self) {
	snap_snap_window_on_stop (self);
}


static void _gtk_main_quit_gtk_button_clicked (GtkButton* _sender, gpointer self) {
	gtk_main_quit ();
}


static void snap_snap_window_setup_window (SnapSnapWindow* self) {
	GtkBox* _tmp0_;
	GtkBox* _tmp1_;
	GtkBox* vbox;
	GtkDrawingArea* _tmp2_;
	GtkDrawingArea* _tmp3_;
	GtkDrawingArea* _tmp4_;
	GtkDrawingArea* _tmp5_;
	GtkButton* _tmp6_;
	GtkButton* _tmp7_;
	GtkButton* play_button;
	GtkButton* _tmp8_;
	GtkButton* _tmp9_;
	GtkButton* stop_button;
	GtkButton* _tmp10_;
	GtkButton* _tmp11_;
	GtkButton* quit_button;
	GtkButtonBox* _tmp12_;
	GtkButtonBox* _tmp13_;
	GtkButtonBox* bb;
	g_return_if_fail (self != NULL);
	_tmp0_ = (GtkBox*) gtk_box_new (GTK_ORIENTATION_VERTICAL, 0);
	_tmp1_ = g_object_ref_sink (_tmp0_);
	vbox = _tmp1_;
	_tmp2_ = (GtkDrawingArea*) gtk_drawing_area_new ();
	_tmp3_ = g_object_ref_sink (_tmp2_);
	_g_object_unref0 (self->priv->drawing_area);
	self->priv->drawing_area = _tmp3_;
	_tmp4_ = self->priv->drawing_area;
	gtk_widget_set_size_request ((GtkWidget*) _tmp4_, 450, 250);
	_tmp5_ = self->priv->drawing_area;
	gtk_box_pack_start (vbox, (GtkWidget*) _tmp5_, TRUE, TRUE, (guint) 0);
	_tmp6_ = (GtkButton*) gtk_button_new_from_stock (GTK_STOCK_MEDIA_PLAY);
	_tmp7_ = g_object_ref_sink (_tmp6_);
	play_button = _tmp7_;
	g_signal_connect_object (play_button, "clicked", (GCallback) _snap_snap_window_on_play_gtk_button_clicked, self, 0);
	_tmp8_ = (GtkButton*) gtk_button_new_from_stock (GTK_STOCK_MEDIA_STOP);
	_tmp9_ = g_object_ref_sink (_tmp8_);
	stop_button = _tmp9_;
	g_signal_connect_object (stop_button, "clicked", (GCallback) _snap_snap_window_on_stop_gtk_button_clicked, self, 0);
	_tmp10_ = (GtkButton*) gtk_button_new_from_stock (GTK_STOCK_QUIT);
	_tmp11_ = g_object_ref_sink (_tmp10_);
	quit_button = _tmp11_;
	g_signal_connect (quit_button, "clicked", (GCallback) _gtk_main_quit_gtk_button_clicked, NULL);
	_tmp12_ = (GtkButtonBox*) gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);
	_tmp13_ = g_object_ref_sink (_tmp12_);
	bb = _tmp13_;
	gtk_container_add ((GtkContainer*) bb, (GtkWidget*) play_button);
	gtk_container_add ((GtkContainer*) bb, (GtkWidget*) stop_button);
	gtk_container_add ((GtkContainer*) bb, (GtkWidget*) quit_button);
	gtk_box_pack_start (vbox, (GtkWidget*) bb, FALSE, TRUE, (guint) 0);
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) vbox);
	gtk_widget_show_all ((GtkWidget*) self);
	_g_object_unref0 (bb);
	_g_object_unref0 (quit_button);
	_g_object_unref0 (stop_button);
	_g_object_unref0 (play_button);
	_g_object_unref0 (vbox);
}


static gpointer _gst_object_ref0 (gpointer self) {
	return self ? gst_object_ref (self) : NULL;
}


static void snap_snap_window_on_play (SnapSnapWindow* self) {
	GstElement* _tmp0_;
	GstXOverlay* _tmp1_;
	GstXOverlay* xoverlay;
	GtkDrawingArea* _tmp2_;
	GdkWindow* _tmp3_ = NULL;
	Window _tmp4_ = 0;
	GstPipeline* _tmp5_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->sink;
	_tmp1_ = _gst_object_ref0 (GST_IS_X_OVERLAY (_tmp0_) ? ((GstXOverlay*) _tmp0_) : NULL);
	xoverlay = _tmp1_;
	_tmp2_ = self->priv->drawing_area;
	_tmp3_ = gtk_widget_get_window ((GtkWidget*) _tmp2_);
	_tmp4_ = gdk_x11_window_get_xid (_tmp3_);
	gst_x_overlay_set_xwindow_id (xoverlay, (gulong) _tmp4_);
	_tmp5_ = self->priv->pipeline;
	gst_element_set_state ((GstElement*) _tmp5_, GST_STATE_PLAYING);
	_gst_object_unref0 (xoverlay);
}


static void snap_snap_window_on_stop (SnapSnapWindow* self) {
	GstPipeline* _tmp0_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->pipeline;
	gst_element_set_state ((GstElement*) _tmp0_, GST_STATE_READY);
}


static void snap_snap_window_setup_gst_pipeline (SnapSnapWindow* self) {
	GstPipeline* _tmp0_;
	GstElement* _tmp1_ = NULL;
	GstElement* _tmp2_ = NULL;
	GstPipeline* _tmp3_;
	GstElement* _tmp4_;
	GstElement* _tmp5_;
	GstElement* _tmp6_;
	GstElement* _tmp7_;
	GstElement* _tmp8_;
	GstElement* _tmp9_;
	g_return_if_fail (self != NULL);
	_tmp0_ = (GstPipeline*) gst_pipeline_new ("mypipeline");
	gst_object_ref_sink (_tmp0_);
	_gst_object_unref0 (self->priv->pipeline);
	self->priv->pipeline = _tmp0_;
	_tmp1_ = gst_element_factory_make ("v4l2src", "video");
	_gst_object_unref0 (self->priv->src);
	self->priv->src = _tmp1_;
	_tmp2_ = gst_element_factory_make ("xvimagesink", "sink");
	_gst_object_unref0 (self->priv->sink);
	self->priv->sink = _tmp2_;
	_tmp3_ = self->priv->pipeline;
	_tmp4_ = self->priv->src;
	_tmp5_ = _gst_object_ref0 (_tmp4_);
	_tmp6_ = self->priv->sink;
	_tmp7_ = _gst_object_ref0 (_tmp6_);
	gst_bin_add_many ((GstBin*) _tmp3_, _tmp5_, _tmp7_, NULL);
	_tmp8_ = self->priv->src;
	_tmp9_ = self->priv->sink;
	gst_element_link (_tmp8_, _tmp9_);
}


static void snap_snap_window_class_init (SnapSnapWindowClass * klass) {
	snap_snap_window_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (SnapSnapWindowPrivate));
	G_OBJECT_CLASS (klass)->finalize = snap_snap_window_finalize;
}


static void snap_snap_window_instance_init (SnapSnapWindow * self) {
	self->priv = SNAP_SNAP_WINDOW_GET_PRIVATE (self);
}


static void snap_snap_window_finalize (GObject* obj) {
	SnapSnapWindow * self;
	self = SNAP_SNAP_WINDOW (obj);
	_g_object_unref0 (self->snap_app);
	_g_object_unref0 (self->priv->drawing_area);
	_gst_object_unref0 (self->priv->pipeline);
	_gst_object_unref0 (self->priv->src);
	_gst_object_unref0 (self->priv->sink);
	G_OBJECT_CLASS (snap_snap_window_parent_class)->finalize (obj);
}


GType snap_snap_window_get_type (void) {
	static volatile gsize snap_snap_window_type_id__volatile = 0;
	if (g_once_init_enter (&snap_snap_window_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (SnapSnapWindowClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) snap_snap_window_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (SnapSnapWindow), 0, (GInstanceInitFunc) snap_snap_window_instance_init, NULL };
		GType snap_snap_window_type_id;
		snap_snap_window_type_id = g_type_register_static (GTK_TYPE_WINDOW, "SnapSnapWindow", &g_define_type_info, 0);
		g_once_init_leave (&snap_snap_window_type_id__volatile, snap_snap_window_type_id);
	}
	return snap_snap_window_type_id__volatile;
}



